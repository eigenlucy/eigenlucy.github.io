{% assign extension = include.path | split: '.' | last %}

<figure>
  {% if extension == 'mp4' or extension == 'webm' or extension == 'ogg' %}
    <video
      src="{% if include.cache_bust %}{{ include.path | relative_url | bust_file_cache }}{% else %}{{ include.path | relative_url }}{% endif %}"
      {% if include.class %}
        class="{{ include.class }}"
      {% endif %}
      {% comment %} Add preload="none" to prevent browsers from downloading video data until play or explicitly requested {% endcomment %}
      preload="none" 
      {% if include.width %}
        width="{{ include.width }}"
      {% else %}
        width="auto"
      {% endif %}
      {% if include.height %}
        height="{{ include.height }}"
      {% else %}
        height="auto"
      {% endif %}
      {% if include['min-width'] %}
        min-width="{{ include.min-width }}"
      {% endif %}
      {% if include['min-height'] %}
        min-height="{{ include.min-height }}"
      {% endif %}
      {% if include['max-width'] %}
        max-width="{{ include.max-width }}"
      {% endif %}
      {% if include['max-height'] %}
        height="{{ include.max-height }}"
      {% endif %}
      {% if include.title %}
        title="{{ include.title }}"
      {% endif %}
      {% if include.alt %}
        alt="{{ include.alt }}"
      {% endif %}
      {% if include.autoplay %}
        autoplay
      {% endif %}
      {% if include.controls %}
        controls
      {% endif %}
      {% if include.loop %}
        loop
      {% endif %}
      {% if include.muted %}
        muted
      {% endif %}
      {% if include.poster %}
        poster="{{ include.poster | relative_url }}" {# Ensure poster path is relative if not full URL #}
      {% endif %}
      {% if include.loading %}
         loading="{{ include.loading }}"
      {% elsif site.lazy_loading_images %}
         loading="lazy"
      {% endif %}
    />
    <div class="video-full-link-container text-right mt-1"> {# ADDED CONTAINER #}
      <a href="{{ include.path | relative_url }}" target="_blank" class="btn btn-sm btn-outline-secondary">View Full Video</a> {# ADDED LINK #}
    </div>                                                                                                    {# ADDED CONTAINER #}

  {% else %} {# This part is for iframes like YouTube #}
    <iframe
      src="{{ include.path }}"
      {% if include.class %}
        class="{{ include.class }}"
      {% endif %}
      frameborder="0"
      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
      allowfullscreen
      {% if include.width %}
        width="{{ include.width }}"
      {% else %}
        width="auto"
      {% endif %}
      {% if include.height %}
        height="{{ include.height }}"
      {% else %}
        height="auto"
      {% endif %}
      {% if include['min-width'] %}
        min-width="{{ include.min-width }}"
      {% endif %}
      {% if include['min-height'] %}
        min-height="{{ include.min-height }}"
      {% endif %}
      {% if include['max-width'] %}
        max-width="{{ include.max-width }}"
      {% endif %}
      {% if include['max-height'] %}
        height="{{ include.max-height }}"
      {% endif %}
      {% if include.alt %}
        alt="{{ include.alt }}"
      {% endif %}
      {% if include.title %}
        title="{{ include.title }}"
      {% endif %}
      {% if include.loading %} {# Added lazy loading for iframes too #}
         loading="{{ include.loading }}"
      {% elsif site.lazy_loading_images %}
         loading="lazy"
      {% endif %}
    />
    {% comment %} For embedded videos like YouTube, the 'View Full' often means going to YouTube.
        We could add a similar link here if include.path is a recognizable YouTube/Vimeo URL.
        For simplicity now, we'll only add the direct link for local video files. {% endcomment %}
  {% endif %}
  {% if include.caption %}
    <figcaption class="caption">{{ include.caption }}</figcaption>
  {% endif %}
</figure>

{# The JavaScript below for custom play buttons might not be used if your cards don't have .video-container or .play-button #}
{# It was present in your original video.liquid, so kept it. #}
<script>
  document.addEventListener('DOMContentLoaded', function() {
    var playButtons = document.querySelectorAll('.video-container .play-button');
    playButtons.forEach(function(button) {
      button.addEventListener('click', function() {
        var video = button.parentElement.querySelector('video');
        if (video) { // Check if video element exists
            video.style.display = 'block';
            video.play();
            if (button.previousElementSibling) { // Check if thumbnail exists
                button.previousElementSibling.style.display = 'none'; // Hide thumbnail
            }
            button.style.display = 'none'; // Hide play button
        }
      });
    });
  });
</script>
